var ge=Object.defineProperty;var we=(p,t,s)=>t in p?ge(p,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):p[t]=s;var P=(p,t,s)=>we(p,typeof t!="symbol"?t+"":t,s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();function ye(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var y={},Y;function ve(){if(Y)return y;Y=1;function p(e,n,d,c){return new(d||(d=Promise))(function(u,g){function f(x){try{C(c.next(x))}catch(E){g(E)}}function w(x){try{C(c.throw(x))}catch(E){g(E)}}function C(x){var E;x.done?u(x.value):(E=x.value,E instanceof d?E:new d(function(O){O(E)})).then(f,w)}C((c=c.apply(e,[])).next())})}function t(){return r("extensions.getStats")}typeof SuppressedError=="function"&&SuppressedError;var s=Object.freeze({__proto__:null,broadcast:function(e,n){return r("extensions.broadcast",{event:e,data:n})},dispatch:function(e,n,d){return new Promise((c,u)=>p(this,void 0,void 0,function*(){const g=yield t();if(g.loaded.includes(e))if(g.connected.includes(e))try{const f=yield r("extensions.dispatch",{extensionId:e,event:n,data:d});c(f)}catch(f){u(f)}else(function(f,w){f in L?L[f].push(w):L[f]=[w]})(e,{method:"extensions.dispatch",data:{extensionId:e,event:n,data:d},resolve:c,reject:u});else u({code:"NE_EX_EXTNOTL",message:`${e} is not loaded`})}))},getStats:t});function i(e,n){return window.addEventListener(e,n),Promise.resolve({success:!0,message:"Event listener added"})}function o(e,n){const d=new CustomEvent(e,{detail:n});return window.dispatchEvent(d),Promise.resolve({success:!0,message:"Message dispatched"})}function a(e){const n=window.atob(e),d=n.length,c=new Uint8Array(d);for(let u=0;u<d;u++)c[u]=n.charCodeAt(u);return c.buffer}function l(e){let n=new Uint8Array(e),d="";for(let c of n)d+=String.fromCharCode(c);return window.btoa(d)}let m;const h={},v=[],L={};function F(){window.NL_TOKEN&&sessionStorage.setItem("NL_TOKEN",window.NL_TOKEN);const e=W().split(".")[1],n=window.NL_GINJECTED||window.NL_CINJECTED?"127.0.0.1":window.location.hostname;m=new WebSocket(`ws://${n}:${window.NL_PORT}?connectToken=${e}`),function(){i("ready",()=>p(this,void 0,void 0,function*(){if(yield R(v),!window.NL_EXTENABLED)return;const d=yield t();for(const c of d.connected)o("extensionReady",c)})),i("extClientConnect",d=>{o("extensionReady",d.detail)}),window.NL_EXTENABLED&&i("extensionReady",d=>p(this,void 0,void 0,function*(){d.detail in L&&(yield R(L[d.detail]),delete L[d.detail])}))}(),function(){m.addEventListener("message",d=>{var c,u,g;const f=JSON.parse(d.data);f.id&&f.id in h?(!((c=f.data)===null||c===void 0)&&c.error?(h[f.id].reject(f.data.error),f.data.error.code=="NE_RT_INVTOKN"&&(m.close(),document.body.innerText="",document.write("<code>NE_RT_INVTOKN</code>: Neutralinojs application cannot execute native methods since <code>NL_TOKEN</code> is invalid."))):!((u=f.data)===null||u===void 0)&&u.success&&h[f.id].resolve(f.data.hasOwnProperty("returnValue")?f.data.returnValue:f.data),delete h[f.id]):f.event&&(f.event=="openedFile"&&((g=f==null?void 0:f.data)===null||g===void 0?void 0:g.action)=="dataBinary"&&(f.data.data=a(f.data.data)),o(f.event,f.data))}),m.addEventListener("open",d=>p(this,void 0,void 0,function*(){o("ready")})),m.addEventListener("close",d=>p(this,void 0,void 0,function*(){o("serverOffline",{code:"NE_CL_NSEROFF",message:"Neutralino server is offline. Try restarting the application"})})),m.addEventListener("error",d=>p(this,void 0,void 0,function*(){document.body.innerText="",document.write("<code>NE_CL_IVCTOKN</code>: Neutralinojs application cannot connect with the framework core using <code>NL_TOKEN</code>.")}))}()}function r(e,n){return new Promise((d,c)=>{if((m==null?void 0:m.readyState)!=WebSocket.OPEN)return u={method:e,data:n,resolve:d,reject:c},void v.push(u);var u;const g="10000000-1000-4000-8000-100000000000".replace(/[018]/g,w=>(w^crypto.getRandomValues(new Uint8Array(1))[0]&15>>w/4).toString(16)),f=W();h[g]={resolve:d,reject:c},m.send(JSON.stringify({id:g,method:e,data:n,accessToken:f}))})}function R(e){return p(this,void 0,void 0,function*(){for(;e.length>0;){const n=e.shift();try{const d=yield r(n.method,n.data);n.resolve(d)}catch(d){n.reject(d)}}})}function W(){return window.NL_TOKEN||sessionStorage.getItem("NL_TOKEN")||""}function K(e,n){return r("filesystem.writeBinaryFile",{path:e,data:l(n)})}var oe=Object.freeze({__proto__:null,appendBinaryFile:function(e,n){return r("filesystem.appendBinaryFile",{path:e,data:l(n)})},appendFile:function(e,n){return r("filesystem.appendFile",{path:e,data:n})},copy:function(e,n,d){return r("filesystem.copy",Object.assign({source:e,destination:n},d))},createDirectory:function(e){return r("filesystem.createDirectory",{path:e})},createWatcher:function(e){return r("filesystem.createWatcher",{path:e})},getAbsolutePath:function(e){return r("filesystem.getAbsolutePath",{path:e})},getOpenedFileInfo:function(e){return r("filesystem.getOpenedFileInfo",{id:e})},getPathParts:function(e){return r("filesystem.getPathParts",{path:e})},getRelativePath:function(e,n){return r("filesystem.getRelativePath",{path:e,base:n})},getStats:function(e){return r("filesystem.getStats",{path:e})},getWatchers:function(){return r("filesystem.getWatchers")},move:function(e,n){return r("filesystem.move",{source:e,destination:n})},openFile:function(e){return r("filesystem.openFile",{path:e})},readBinaryFile:function(e,n){return new Promise((d,c)=>{r("filesystem.readBinaryFile",Object.assign({path:e},n)).then(u=>{d(a(u))}).catch(u=>{c(u)})})},readDirectory:function(e,n){return r("filesystem.readDirectory",Object.assign({path:e},n))},readFile:function(e,n){return r("filesystem.readFile",Object.assign({path:e},n))},remove:function(e){return r("filesystem.remove",{path:e})},removeWatcher:function(e){return r("filesystem.removeWatcher",{id:e})},updateOpenedFile:function(e,n,d){return r("filesystem.updateOpenedFile",{id:e,event:n,data:d})},writeBinaryFile:K,writeFile:function(e,n){return r("filesystem.writeFile",{path:e,data:n})}});function $(e,n){return r("os.execCommand",Object.assign({command:e},n))}var re=Object.freeze({__proto__:null,execCommand:$,getEnv:function(e){return r("os.getEnv",{key:e})},getEnvs:function(){return r("os.getEnvs")},getPath:function(e){return r("os.getPath",{name:e})},getSpawnedProcesses:function(){return r("os.getSpawnedProcesses")},open:function(e){return r("os.open",{url:e})},setTray:function(e){return r("os.setTray",e)},showFolderDialog:function(e,n){return r("os.showFolderDialog",Object.assign({title:e},n))},showMessageBox:function(e,n,d,c){return r("os.showMessageBox",{title:e,content:n,choice:d,icon:c})},showNotification:function(e,n,d){return r("os.showNotification",{title:e,content:n,icon:d})},showOpenDialog:function(e,n){return r("os.showOpenDialog",Object.assign({title:e},n))},showSaveDialog:function(e,n){return r("os.showSaveDialog",Object.assign({title:e},n))},spawnProcess:function(e,n){return r("os.spawnProcess",{command:e,cwd:n})},updateSpawnedProcess:function(e,n,d){return r("os.updateSpawnedProcess",{id:e,event:n,data:d})}}),se=Object.freeze({__proto__:null,getArch:function(){return r("computer.getArch")},getCPUInfo:function(){return r("computer.getCPUInfo")},getDisplays:function(){return r("computer.getDisplays")},getKernelInfo:function(){return r("computer.getKernelInfo")},getMemoryInfo:function(){return r("computer.getMemoryInfo")},getMousePosition:function(){return r("computer.getMousePosition")},getOSInfo:function(){return r("computer.getOSInfo")}}),ie=Object.freeze({__proto__:null,getData:function(e){return r("storage.getData",{key:e})},getKeys:function(){return r("storage.getKeys")},setData:function(e,n){return r("storage.setData",{key:e,data:n})}});function q(e,n){return r("debug.log",{message:e,type:n})}var ae=Object.freeze({__proto__:null,log:q});function Z(e){return r("app.exit",{code:e})}var ce=Object.freeze({__proto__:null,broadcast:function(e,n){return r("app.broadcast",{event:e,data:n})},exit:Z,getConfig:function(){return r("app.getConfig")},killProcess:function(){return r("app.killProcess")},readProcessInput:function(e){return r("app.readProcessInput",{readAll:e})},restartProcess:function(e){return new Promise(n=>p(this,void 0,void 0,function*(){let d=window.NL_ARGS.reduce((c,u)=>(u.includes(" ")&&(u=`"${u}"`),c+=" "+u),"");e!=null&&e.args&&(d+=" "+e.args),yield $(d,{background:!0}),Z(),n()}))},writeProcessError:function(e){return r("app.writeProcessError",{data:e})},writeProcessOutput:function(e){return r("app.writeProcessOutput",{data:e})}});const k=new WeakMap;function H(e,n){return r("window.move",{x:e,y:n})}function J(){return r("window.getSize")}var le=Object.freeze({__proto__:null,center:function(){return r("window.center")},create:function(e,n){return new Promise((d,c)=>{function u(f){return typeof f!="string"||(f=f.trim()).includes(" ")&&(f=`"${f}"`),f}n=Object.assign(Object.assign({},n),{useSavedState:!1});let g=window.NL_ARGS.reduce((f,w,C)=>((w.includes("--path=")||w.includes("--debug-mode")||w.includes("--load-dir-res")||C==0)&&(f+=" "+u(w)),f),"");g+=" --url="+u(e);for(let f in n)f!="processArgs"&&(g+=` --window${"-"+f.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}=${u(n[f])}`);n&&n.processArgs&&(g+=" "+n.processArgs),$(g,{background:!0}).then(f=>{d(f)}).catch(f=>{c(f)})})},exitFullScreen:function(){return r("window.exitFullScreen")},focus:function(){return r("window.focus")},getPosition:function(){return r("window.getPosition")},getSize:J,getTitle:function(){return r("window.getTitle")},hide:function(){return r("window.hide")},isFullScreen:function(){return r("window.isFullScreen")},isMaximized:function(){return r("window.isMaximized")},isMinimized:function(){return r("window.isMinimized")},isVisible:function(){return r("window.isVisible")},maximize:function(){return r("window.maximize")},minimize:function(){return r("window.minimize")},move:H,setAlwaysOnTop:function(e){return r("window.setAlwaysOnTop",{onTop:e})},setDraggableRegion:function(e,n={}){return new Promise((d,c)=>{const u=e instanceof Element?e:document.getElementById(e);let g=0,f=0,w=0,C=!1,x=performance.now(),E=n.alwaysCapture;if(!u)return c({code:"NE_WD_DOMNOTF",message:"Unable to find DOM element"});if(k.has(u))return c({code:"NE_WD_ALRDREL",message:"This DOM element is already an active draggable region"});function O(_){return p(this,void 0,void 0,function*(){var I;const j=_.clientX-g,b=_.clientY-f;if(w=Math.sqrt(j*j+b*b),w>=((I=n.dragMinDistance)!==null&&I!==void 0?I:10)&&(C=!0,E||(u.setPointerCapture(_.pointerId),E=!0)),C){const z=performance.now(),M=z-x;return M<5?void 0:(x=z-(M-5),void(yield H(_.screenX-g,_.screenY-f)))}})}function B(_){_.button===0&&(g=_.clientX,f=_.clientY,u.addEventListener("pointermove",O),n.alwaysCapture&&u.setPointerCapture(_.pointerId))}function N(_){u.removeEventListener("pointermove",O),u.releasePointerCapture(_.pointerId)}u.addEventListener("pointerdown",B),u.addEventListener("pointerup",N),u.addEventListener("pointercancel",N),k.set(u,{pointerdown:B,pointerup:N}),d({success:!0,message:"Draggable region was activated"})})},setFullScreen:function(){return r("window.setFullScreen")},setIcon:function(e){return r("window.setIcon",{icon:e})},setSize:function(e){return new Promise((n,d)=>p(this,void 0,void 0,function*(){let c=yield J();r("window.setSize",e=Object.assign(Object.assign({},c),e)).then(u=>{n(u)}).catch(u=>{d(u)})}))},setTitle:function(e){return r("window.setTitle",{title:e})},show:function(){return r("window.show")},snapshot:function(e){return r("window.snapshot",{path:e})},unmaximize:function(){return r("window.unmaximize")},unminimize:function(){return r("window.unminimize")},unsetDraggableRegion:function(e){return new Promise((n,d)=>{const c=e instanceof Element?e:document.getElementById(e);if(!c)return d({code:"NE_WD_DOMNOTF",message:"Unable to find DOM element"});if(!k.has(c))return d({code:"NE_WD_NOTDRRE",message:"DOM element is not an active draggable region"});const{pointerdown:u,pointerup:g}=k.get(c);c.removeEventListener("pointerdown",u),c.removeEventListener("pointerup",g),c.removeEventListener("pointercancel",g),k.delete(c),n({success:!0,message:"Draggable region was deactivated"})})}}),de=Object.freeze({__proto__:null,broadcast:function(e,n){return r("events.broadcast",{event:e,data:n})},dispatch:o,off:function(e,n){return window.removeEventListener(e,n),Promise.resolve({success:!0,message:"Event listener removed"})},on:i});let A=null;var ue=Object.freeze({__proto__:null,checkForUpdates:function(e){return new Promise((n,d)=>p(this,void 0,void 0,function*(){if(!e)return d({code:"NE_RT_NATRTER",message:"Missing require parameter: url"});try{const c=yield fetch(e);A=JSON.parse(yield c.text()),function(u){return!!(u.applicationId&&u.applicationId==window.NL_APPID&&u.version&&u.resourcesURL)}(A)?n(A):d({code:"NE_UP_CUPDMER",message:"Invalid update manifest or mismatching applicationId"})}catch{d({code:"NE_UP_CUPDERR",message:"Unable to fetch update manifest"})}}))},install:function(){return new Promise((e,n)=>p(this,void 0,void 0,function*(){if(!A)return n({code:"NE_UP_UPDNOUF",message:"No update manifest loaded"});try{const d=yield fetch(A.resourcesURL),c=yield d.arrayBuffer();yield K(window.NL_PATH+"/resources.neu",c),e({success:!0,message:"Update installed. Restart the process to see updates"})}catch{n({code:"NE_UP_UPDINER",message:"Update installation error"})}}))}}),fe=Object.freeze({__proto__:null,clear:function(){return r("clipboard.clear")},getFormat:function(){return r("clipboard.getFormat")},readImage:function(e=""){return new Promise((n,d)=>{r("clipboard.readImage").then(c=>{if(c){const u=window.atob(c.data);let g,f,w,C=c.bpp==32?4:3;switch(e.toLowerCase()){case"rgb":g=c.width*c.height*3,f=[0,1,2];break;case"rgba":g=c.width*c.height*4,f=[0,1,2,3];break;case"argb":g=c.width*c.height*4,f=[3,0,1,2];break;case"bgra":g=c.width*c.height*4,f=[2,1,0,3];break;default:g=u.length,w=new Uint8Array(g);for(let b=0;b<g;b++)w[b]=u.charCodeAt(b);return c.data=w,void n(c)}w=new Uint8Array(g);let x,E,O,B,N,_=new Uint8Array(new Uint32Array([255]).buffer)[0]==255,I=[],j=0;for(let b=0;b<u.length;b+=C)x=u.charCodeAt(b),E=u.charCodeAt(b+1),O=u.charCodeAt(b+2),B=C==4?u.charCodeAt(b+3):255,N=_?(B<<24|O<<16|E<<8|x)>>>0:(x<<24|E<<16|O<<8|B)>>>0,I=[N>>c.redShift&255,N>>c.greenShift&255,N>>c.blueShift&255,N>>c.alphaShift&255],f.forEach((z,M)=>{w[M+j]=I[z]}),j+=f.length;c.data=w}n(c)}).catch(c=>{d(c)})})},readText:function(){return r("clipboard.readText")},writeImage:function(e){const n=Object.assign({},e);return e!=null&&e.data&&(n.data=l(e.data)),r("clipboard.writeImage",n)},writeText:function(e){return r("clipboard.writeText",{data:e})}}),pe=Object.freeze({__proto__:null,extractDirectory:function(e,n){return r("resources.extractDirectory",{path:e,destination:n})},extractFile:function(e,n){return r("resources.extractFile",{path:e,destination:n})},getFiles:function(){return r("resources.getFiles")},getStats:function(e){return r("resources.getStats",{path:e})},readBinaryFile:function(e){return new Promise((n,d)=>{r("resources.readBinaryFile",{path:e}).then(c=>{n(a(c))}).catch(c=>{d(c)})})},readFile:function(e){return r("resources.readFile",{path:e})}}),me=Object.freeze({__proto__:null,getMounts:function(){return r("server.getMounts")},mount:function(e,n){return r("server.mount",{path:e,target:n})},unmount:function(e){return r("server.unmount",{path:e})}}),he=Object.freeze({__proto__:null,getMethods:function(){return r("custom.getMethods")}});let G=!1;return y.app=ce,y.clipboard=fe,y.computer=se,y.custom=he,y.debug=ae,y.events=de,y.extensions=s,y.filesystem=oe,y.init=function(e={}){if(e=Object.assign({exportCustomMethods:!0},e),!G){if(F(),window.NL_ARGS.find(n=>n=="--neu-dev-auto-reload")&&i("neuDev_reloadApp",()=>p(this,void 0,void 0,function*(){yield q("Reloading the application..."),location.reload()})),e.exportCustomMethods&&window.NL_CMETHODS&&window.NL_CMETHODS.length>0)for(const n of window.NL_CMETHODS)Neutralino.custom[n]=(...d)=>{let c={};for(const[u,g]of d.entries())c=typeof g!="object"||Array.isArray(g)||g==null?Object.assign(Object.assign({},c),{["arg"+u]:g}):Object.assign(Object.assign({},c),g);return r("custom."+n,c)};window.NL_CVERSION="5.6.0",window.NL_CCOMMIT="425c526c318342e0e5d0f17caceef2a53049eda4",G=!0}},y.os=re,y.resources=pe,y.server=me,y.storage=ie,y.updater=ue,y.window=le,y}var Ee=ve();const D=ye(Ee),xe=Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"})),_e="modulepreload",be=function(p){return"/"+p},Q={},Se=function(t,s,i){let o=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),m=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=Promise.allSettled(s.map(h=>{if(h=be(h),h in Q)return;Q[h]=!0;const v=h.endsWith(".css"),L=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${L}`))return;const F=document.createElement("link");if(F.rel=v?"stylesheet":_e,v||(F.as="script"),F.crossOrigin="",F.href=h,m&&F.setAttribute("nonce",m),document.head.appendChild(F),v)return new Promise((r,R)=>{F.addEventListener("load",r),F.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${h}`)))})}))}function a(l){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=l,window.dispatchEvent(m),!m.defaultPrevented)throw l}return o.then(l=>{for(const m of l||[])m.status==="rejected"&&a(m.reason);return t().catch(a)})};(p=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(p,{get:(t,s)=>(typeof require<"u"?require:t)[s]}):p)(function(p){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+p+'" is not supported')});var X,V,Le=async p=>{try{let t=await(0,eval)(p.detail.js);X.send(JSON.stringify({token:V,command:"execResult",id:p.detail.requestId,returnValue:t}))}catch(t){X.send(JSON.stringify({token:V,command:"execResult",id:p.detail.requestId,error:t.message,stack:t.stack}))}},Ce=async(p,t,s)=>{X=s,V=t,p.events.on("buntralinoEval",Le),p.events.on("buntralinoNavigate",i=>{window.location.href=i.detail.url}),p.events.on("buntralinoReload",()=>{window.location.reload()})},S;window.Neutralino&&(S=window.Neutralino);var ee,U,T,te,ne;new Promise((p,t)=>{te=p,ne=t});(async()=>(S||(S=(await Se(async()=>{const{default:p}=await Promise.resolve().then(()=>xe);return{default:p}},void 0)).default),S.events.on("ready",async()=>{if(window.NL_RESMODE==="bundle"&&!window.NL_ARGS.some(p=>p.startsWith("--buntralino-name="))){let p=await S.app.getConfig(),t=`${window.NL_CWD}/${p.cli.binaryName}`;window.NL_OS==="Windows"&&(t+=".exe");try{S.filesystem.getStats(t),await S.os.execCommand(`"${t}"`,{background:!0,cwd:window.NL_CWD}),S.app.exit()}catch{window.alert('"neutralino" is not the main executable! Please run the other one.'),S.app.exit()}finally{return}}try{let p=window.NL_ARGS.find(l=>l.startsWith("--buntralino-port=")),t=window.NL_ARGS.find(l=>l.startsWith("--buntralino-name="));if(!p||!t)return;let[,s]=p.split("="),[,i]=t.split("="),o=window.NL_TOKEN||sessionStorage.NL_TOKEN;T=new WebSocket(`ws://127.0.0.1:${s}`),T.onopen=()=>{console.debug("âš›ï¸ Announcing ourself to Buntralinoâ€¦"),T.send(JSON.stringify({command:"announceSelf",name:i,NL_PORT:window.NL_PORT,NL_TOKEN:o}))};let a=l=>{S.events.off("buntralinoRegisterParent",a),!(!l.detail.token||!l.detail.port)&&(ee=l.detail.token,U=l.detail.port,T=new WebSocket(`ws://127.0.0.1:${U}`),T.onopen=()=>{Ce(S,ee,T),console.log("âš›ï¸ðŸ¥Ÿ Buntralino connected on port",U),te()})};S.events.on("buntralinoRegisterParent",a)}catch(p){ne(p),console.error("âš›ï¸ Buntralino failed with",p)}}),S.init()))();D.init();class Fe{constructor(){P(this,"uploadedFiles",[]);P(this,"sharedColumns",[]);P(this,"mergedData",[]);P(this,"isDialogOpen",!1);P(this,"handleChooseFilesClick",t=>{t.preventDefault(),this.openFileDialog()});P(this,"handleDropZoneClick",()=>{this.openFileDialog()});this.initializeApp(),this.setupEventListeners()}initializeApp(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.setupEventListeners()):this.setupEventListeners()}setupEventListeners(){const t=document.getElementById("chooseFilesBtn"),s=document.getElementById("dropZone");t&&(t.removeEventListener("click",this.handleChooseFilesClick),t.addEventListener("click",this.handleChooseFilesClick.bind(this))),s&&(s.removeEventListener("click",this.handleDropZoneClick),s.removeEventListener("dragover",this.handleDragOver),s.removeEventListener("dragleave",this.handleDragLeave),s.removeEventListener("drop",this.handleFileDrop),s.addEventListener("click",this.handleDropZoneClick.bind(this)),s.addEventListener("dragover",h=>this.handleDragOver(h)),s.addEventListener("dragleave",h=>this.handleDragLeave(h)),s.addEventListener("drop",h=>this.handleFileDrop(h)));const i=document.getElementById("analyzeBtn"),o=document.getElementById("mergeBtn"),a=document.getElementById("exportExcelBtn"),l=document.getElementById("exportCsvBtn"),m=document.getElementById("removeFileBtn");i&&i.addEventListener("click",()=>this.analyzeColumns()),o&&o.addEventListener("click",()=>this.mergeFiles()),a&&a.addEventListener("click",()=>this.exportData("excel")),l&&l.addEventListener("click",()=>this.exportData("csv")),m&&m.addEventListener("click",()=>this.removeSelectedFile())}async openFileDialog(){var t,s;if(!this.isDialogOpen){this.isDialogOpen=!0;try{const i=await D.os.showOpenDialog("Select Files",{defaultPath:await D.os.getPath("documents"),filters:[{name:"Excel Files",extensions:["xlsx","xls"]},{name:"CSV Files",extensions:["csv"]},{name:"All Files",extensions:["*"]}],multiSelection:!0});i&&i.length>0&&await this.processFilePaths(i)}catch(i){console.error("Error opening file dialog:",i),i&&!((t=i.message)!=null&&t.includes("cancelled"))&&!((s=i.message)!=null&&s.includes("canceled"))&&this.showHtmlFileInput()}finally{this.isDialogOpen=!1}}}showHtmlFileInput(){const t=document.createElement("input");t.type="file",t.multiple=!0,t.accept=".xlsx,.xls,.csv",t.style.display="none",t.addEventListener("change",async s=>{const i=s.target,o=Array.from(i.files||[]);await this.processFiles(o),document.body.removeChild(t)}),document.body.appendChild(t),t.click()}handleDragOver(t){t.preventDefault(),t.currentTarget.classList.add("dragover")}handleDragLeave(t){t.currentTarget.classList.remove("dragover")}async handleFileDrop(t){var o;t.preventDefault(),t.currentTarget.classList.remove("dragover");const i=Array.from(((o=t.dataTransfer)==null?void 0:o.files)||[]);await this.processFiles(i)}async processFilePaths(t){if(t.length===0)return;const s=t.filter(i=>{var a;const o=(a=i.split(".").pop())==null?void 0:a.toLowerCase();return["xlsx","xls","csv"].includes(o||"")});for(const i of s)try{const o=await this.processFilePath(i);this.uploadedFiles.push(o)}catch(o){console.error(`Error processing ${i}:`,o)}this.updateFileList(),this.updateUploadStatus(),this.updateButtonStates()}async processFiles(t){if(t.length===0)return;const s=t.filter(i=>{var a;const o=(a=i.name.split(".").pop())==null?void 0:a.toLowerCase();return["xlsx","xls","csv"].includes(o||"")});for(const i of s)try{const o=await this.processFile(i);this.uploadedFiles.push(o)}catch(o){console.error(`Error processing ${i.name}:`,o)}this.updateFileList(),this.updateUploadStatus(),this.updateButtonStates()}async processFilePath(t){var l;const s=t.split("/").pop()||t,i=(l=s.split(".").pop())==null?void 0:l.toLowerCase();let o,a=[];try{const m=await D.filesystem.readBinaryFile(t);if(i==="csv"){const h=await this.readCSVFromBuffer(m);o=h.data,a=h.columns}else if(["xlsx","xls"].includes(i||"")){const h=await this.readExcelFromBuffer(m);o=h.data,a=h.columns}else throw new Error(`Unsupported file type: ${i}`);return{name:s,path:t,type:i==="csv"?"csv":"excel",data:o,columns:a,rows:o.length-1,status:"loaded"}}catch(m){throw console.error(`Error reading file ${t}:`,m),m}}async processFile(t){var l;const s=t.name,i=(l=t.name.split(".").pop())==null?void 0:l.toLowerCase();let o,a=[];if(i==="csv"){const m=await this.readCSV(t);o=m.data,a=m.columns}else if(["xlsx","xls"].includes(i||"")){const m=await this.readExcel(t);o=m.data,a=m.columns}else throw new Error(`Unsupported file type: ${i}`);return{name:s,path:t.name,type:i==="csv"?"csv":"excel",data:o,columns:a,rows:o.length-1,status:"loaded"}}async readCSVFromBuffer(t){const i=new TextDecoder("utf-8").decode(t).split(`
`).filter(l=>l.trim());if(i.length===0)throw new Error("Empty CSV file");const o=[],a=[];return i.forEach((l,m)=>{const h=this.parseCSVLine(l);m===0&&a.push(...h.map(v=>this.cleanColumnName(v))),o.push(h)}),{data:o,columns:a}}async readCSV(t){const i=(await t.text()).split(`
`).filter(l=>l.trim());if(i.length===0)throw new Error("Empty CSV file");const o=[],a=[];return i.forEach((l,m)=>{const h=this.parseCSVLine(l);m===0&&a.push(...h.map(v=>this.cleanColumnName(v))),o.push(h)}),{data:o,columns:a}}async readExcelFromBuffer(t){const s=window.XLSX.read(t,{type:"array"}),i=s.SheetNames[0],o=s.Sheets[i],l=window.XLSX.utils.sheet_to_json(o,{header:1});if(l.length===0)throw new Error("Empty Excel file");const m=l[0].map(h=>this.cleanColumnName(h));return{data:l,columns:m}}async readExcel(t){const s=await t.arrayBuffer(),i=window.XLSX.read(s,{type:"array"}),o=i.SheetNames[0],a=i.Sheets[o],m=window.XLSX.utils.sheet_to_json(a,{header:1});if(m.length===0)throw new Error("Empty Excel file");const h=m[0].map(v=>this.cleanColumnName(v));return{data:m,columns:h}}parseCSVLine(t){const s=[];let i="",o=!1;for(let a=0;a<t.length;a++){const l=t[a];l==='"'?o=!o:l===","&&!o?(s.push(i.trim()),i=""):i+=l}return s.push(i.trim()),s}cleanColumnName(t){if(!t||t==="")return"Unnamed_Column";let s=String(t).trim();return s=s.replace(/\s+/g," "),s=s.replace(/[^\w\s-]/g,""),s=s.replace(/\s/g,"_"),s||"Unnamed_Column"}updateFileList(){const t=document.getElementById("fileListBody");if(!t)return;if(this.uploadedFiles.length===0){t.innerHTML='<tr><td colspan="6" class="text-center text-gray-500 py-8">No files uploaded</td></tr>';return}t.innerHTML=this.uploadedFiles.map((o,a)=>`
      <tr>
        <td><input type="checkbox" class="file-checkbox rounded" data-index="${a}"></td>
        <td class="font-medium">${o.name}</td>
        <td><span class="px-2 py-1 rounded text-xs ${o.type==="excel"?"bg-blue-900 text-blue-300":"bg-green-900 text-green-300"}">${o.type.toUpperCase()}</span></td>
        <td>${o.rows}</td>
        <td>${o.columns.length}</td>
        <td><span class="status-${o.status}">${o.status}</span></td>
      </tr>
    `).join("");const s=t.querySelectorAll(".file-checkbox");s.forEach(o=>{o.addEventListener("change",()=>this.updateRemoveButtonState())});const i=document.getElementById("selectAll");i&&i.addEventListener("change",o=>{const a=o.target.checked;s.forEach(l=>{l.checked=a}),this.updateRemoveButtonState()})}updateUploadStatus(){const t=document.getElementById("uploadStatus");if(!t)return;const s=this.uploadedFiles.length;s===0?(t.textContent="No files uploaded",t.className="text-sm text-gray-400"):(t.textContent=`${s} file(s) uploaded`,t.className="text-sm text-teal-400")}updateButtonStates(){const t=this.uploadedFiles.length>0,s=this.uploadedFiles.some(m=>m.status==="loaded"),i=document.getElementById("analyzeBtn"),o=document.getElementById("mergeBtn"),a=document.getElementById("exportExcelBtn"),l=document.getElementById("exportCsvBtn");i&&(i.disabled=!t),o&&(o.disabled=!s||this.sharedColumns.length===0),a&&(a.disabled=this.mergedData.length===0),l&&(l.disabled=this.mergedData.length===0)}updateRemoveButtonState(){const t=document.getElementById("removeFileBtn"),s=document.querySelectorAll(".file-checkbox:checked");t&&(t.disabled=s.length===0)}analyzeColumns(){if(this.uploadedFiles.length===0)return;const s=this.uploadedFiles.map(l=>new Set(l.columns)).reduce((l,m)=>new Set([...l].filter(h=>m.has(h))));this.sharedColumns=Array.from(s).sort();const i=document.getElementById("analysisStatus"),o=document.getElementById("sharedColumnsDisplay"),a=document.getElementById("sharedColumnsList");i&&(this.sharedColumns.length>0?(i.textContent=`Found ${this.sharedColumns.length} shared columns`,i.className="text-sm text-teal-400"):(i.textContent="No shared columns found",i.className="text-sm text-yellow-400")),o&&a&&(this.sharedColumns.length>0?(o.classList.remove("hidden"),a.innerHTML=this.sharedColumns.map(l=>`<span class="bg-teal-900 text-teal-300 px-2 py-1 rounded text-sm">${l}</span>`).join("")):o.classList.add("hidden")),this.updateButtonStates()}async mergeFiles(){var t;if(this.uploadedFiles.length!==0)try{const s=this.uploadedFiles.filter(o=>o.status==="loaded");this.mergedData=this.mergeFilesData(s,this.sharedColumns);const i=`Successfully merged ${s.length} files!
Total rows: ${this.mergedData.length-1}
Total columns: ${((t=this.mergedData[0])==null?void 0:t.length)||0}`;alert(i),this.updateButtonStates()}catch(s){console.error("Merge error:",s),alert(`Failed to merge files: ${s}`)}}mergeFilesData(t,s){if(t.length===0)return[];const i=[],o=[...s];return i.push(o),t.forEach(a=>{if(a.status!=="loaded"||a.data.length===0)return;a.data[0],a.data.slice(1).forEach(m=>{const h=[];s.forEach(v=>{const L=a.columns.indexOf(v);h.push(L!==-1?m[L]:"")}),i.push(h)})}),i}async exportData(t){if(this.mergedData.length===0){alert("Please merge files first");return}const i=`merged_data_${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.${t==="excel"?"xlsx":"csv"}`;try{let o;try{o=await D.os.showSaveDialog("Save Merged File",{defaultPath:await D.os.getPath("documents")+"/"+i,filters:t==="excel"?[{name:"Excel Files",extensions:["xlsx"]}]:[{name:"CSV Files",extensions:["csv"]}]})}catch{o=i}t==="excel"?await this.exportToExcel(this.mergedData,o):await this.exportToCSV(this.mergedData,o);const a=document.getElementById("exportStatus");a&&(a.textContent=`Exported to: ${o}`,a.className="mt-4 text-sm text-teal-400")}catch(o){console.error("Export error:",o);const a=document.getElementById("exportStatus");a&&(a.textContent="Export failed",a.className="mt-4 text-sm text-red-400")}}async exportToCSV(t,s){const i=t.map(o=>o.map(a=>`"${String(a).replace(/"/g,'""')}"`).join(",")).join(`
`);try{await D.filesystem.writeFile(s,i)}catch{const a=new Blob([i],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),m=URL.createObjectURL(a);l.setAttribute("href",m),l.setAttribute("download",s.split("/").pop()||"merged_data.csv"),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(m)}}async exportToExcel(t,s){const i=window.XLSX.utils.aoa_to_sheet(t),o=window.XLSX.utils.book_new();window.XLSX.utils.book_append_sheet(o,i,"Merged Data");try{const a=window.XLSX.write(o,{type:"array",bookType:"xlsx"});await D.filesystem.writeBinaryFile(s,a)}catch{window.XLSX.writeFile(o,s.split("/").pop()||"merged_data.xlsx")}}removeSelectedFile(){const t=document.querySelectorAll(".file-checkbox:checked");Array.from(t).map(a=>parseInt(a.dataset.index||"0")).sort((a,l)=>l-a).forEach(a=>{this.uploadedFiles.splice(a,1)}),this.updateFileList(),this.updateUploadStatus(),this.updateButtonStates(),this.sharedColumns=[];const i=document.getElementById("sharedColumnsDisplay");i&&i.classList.add("hidden");const o=document.getElementById("analysisStatus");o&&(o.textContent="Click 'Analyze Columns' to detect shared columns",o.className="text-sm text-gray-400")}}new Fe;
